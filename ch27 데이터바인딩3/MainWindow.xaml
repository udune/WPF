<Window x:Class="ch27_데이터바인딩3.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:ch27_데이터바인딩3"
        mc:Ignorable="d"
        Title="MainWindow" Height="450" Width="800">
    
    <!-- 
        ch27 데이터바인딩3 - ListBox와 ListView의 ItemsSource 바인딩 예제
        컬렉션 데이터를 UI 컨트롤에 바인딩하여 자동으로 표시하는 방법을 시연합니다.
        ListBox는 ItemTemplate으로, ListView는 GridView로 데이터를 표현합니다.
        
        핵심 개념:
        - ItemsSource: 컬렉션 데이터를 컨트롤에 바인딩
        - ItemTemplate: 각 항목의 표시 방식 정의 (ListBox)
        - GridView: 표 형식의 데이터 표시 (ListView)
        - DisplayMemberBinding: 간단한 텍스트 바인딩
        - CellTemplate: 셀의 복잡한 UI 정의
    -->
    
    <Grid>
        <!-- 
            Grid: 화면을 두 개의 열로 분할
            왼쪽: ListBox (사용자 정의 템플릿)
            오른쪽: ListView (GridView - 표 형식)
        -->
        
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="1*"/>
            <!-- 왼쪽 열: 화면의 50% (1*) -->
            <ColumnDefinition Width="1*"/>
            <!-- 오른쪽 열: 화면의 50% (1*) -->
        </Grid.ColumnDefinitions>
        
        <!-- ========== ListBox (사용자 정의 ItemTemplate) ========== -->
        
        <ListBox Grid.Column="0" Name="lb">
            <!-- 
                ListBox:
                - 항목 목록을 세로로 표시하는 컨트롤
                - 각 항목을 선택할 수 있음
                
                Grid.Column="0":
                - 왼쪽 열에 배치
                
                Name="lb":
                - 코드 비하인드에서 접근할 이름
                - lb.ItemsSource = person으로 데이터 바인딩
                
                ItemsSource 바인딩:
                - 코드: lb.ItemsSource = person;
                - person: List<Person> 컬렉션
                - 컬렉션의 각 항목이 ListBox에 자동으로 추가됨
                
                동작:
                1. ItemsSource에 List<Person> 설정
                2. 각 Person 객체가 ListBoxItem으로 변환
                3. ItemTemplate에 정의된 UI로 표시
                4. 5개의 Person → 5개의 ListBoxItem
                
                ItemTemplate이 없으면?
                - Person.ToString() 결과가 표시됨
                - "ch27_데이터바인딩3.Person" (타입 이름)
                - ItemTemplate으로 원하는 UI 구성
            -->
            
            <ListBox.ItemTemplate>
                <!-- 
                    ItemTemplate:
                    - 각 항목(Person)을 어떻게 표시할지 정의
                    - DataTemplate으로 UI 구성
                    
                    DataTemplate:
                    - 데이터를 표시하기 위한 UI 템플릿
                    - 각 Person 객체가 DataContext로 설정됨
                    - {Binding 이름}은 Person.이름을 의미
                    
                    자동 DataContext:
                    - 각 항목의 DataContext = Person 인스턴스
                    - 첫 번째 항목: new Person { 이름="홍길동", 나이=100, 별점=95 }
                    - 두 번째 항목: new Person { 이름="임꺽정", 나이=90, 별점=89 }
                    - 각각 독립적인 DataContext
                -->
                <DataTemplate>
                    <!-- 
                        DataTemplate 내부:
                        - 하나의 Person 객체를 표시하는 UI
                        - 이 템플릿이 각 Person마다 반복 생성됨
                    -->
                    
                    <Grid>
                        <!-- 
                            Grid: 3열 레이아웃
                            - 이름, 나이, 별점을 가로로 나열
                        -->
                        
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition/>
                            <!-- 열 1: 이름 (자동 크기) -->
                            <ColumnDefinition/>
                            <!-- 열 2: 나이 (자동 크기) -->
                            <ColumnDefinition/>
                            <!-- 열 3: 별점 (자동 크기) -->
                        </Grid.ColumnDefinitions>
                        
                        <TextBlock Grid.Column="0" Text="{Binding 이름}"/>
                        <!-- 
                            TextBlock - 이름 표시:
                            - Grid.Column="0": 첫 번째 열
                            - Text="{Binding 이름}": Person.이름 속성 바인딩
                            
                            바인딩 동작:
                            1. DataContext = Person 인스턴스
                            2. {Binding 이름} → Person.이름 읽기
                            3. 첫 번째 항목: "홍길동"
                            4. 두 번째 항목: "임꺽정"
                            
                            DataContext가 자동으로 설정되므로:
                            - ElementName 불필요
                            - Path만 지정 (이름)
                        -->
                        
                        <Label Grid.Column="1" Content="{Binding 나이}"/>
                        <!-- 
                            Label - 나이 표시:
                            - Grid.Column="1": 두 번째 열
                            - Content="{Binding 나이}": Person.나이 속성 바인딩
                            
                            자동 형변환:
                            - 나이는 int 타입
                            - Content는 object 타입
                            - WPF가 자동으로 "100", "90" 등으로 변환
                        -->
                        
                        <ProgressBar Grid.Column="2" Value="{Binding 별점}" Width="100"/>
                        <!-- 
                            ProgressBar - 별점 표시:
                            - Grid.Column="2": 세 번째 열
                            - Value="{Binding 별점}": Person.별점 속성 바인딩
                            - Width="100": 고정 너비 100픽셀
                            
                            ProgressBar:
                            - Minimum: 0 (기본값)
                            - Maximum: 100 (기본값)
                            - Value: 별점 (95, 89, 85, 80, 90)
                            
                            시각적 표현:
                            - 별점 95 → 95% 채워진 진행 표시줄
                            - 별점 80 → 80% 채워진 진행 표시줄
                            
                            사용 예:
                            - 별점, 평점, 진행률 표시
                            - 시각적 피드백
                        -->
                    </Grid>
                </DataTemplate>
            </ListBox.ItemTemplate>
            
            <!--
                ListBox 최종 결과:
                
                ┌─────────────────────────────┐
                │ 홍길동  100  [■■■■■95%]  │ ← 선택 가능
                │ 임꺽정   90  [■■■■ 89%]  │
                │ 타요     10  [■■■  85%]  │
                │ 뽀로로    5  [■■■  80%]  │
                │ 타요      7  [■■■■ 90%]  │
                └─────────────────────────────┘
                
                각 행이 하나의 Person 객체:
                - 클릭하면 선택됨 (배경색 변경)
                - SelectedItem으로 선택된 Person 얻기
                - SelectedIndex로 선택된 인덱스 얻기
            -->
        </ListBox>
        
        <!-- ========== ListView (GridView - 표 형식) ========== -->
        
        <ListView Grid.Column="1" Name="lv">
            <!-- 
                ListView:
                - 항목 목록을 다양한 방식으로 표시하는 컨트롤
                - GridView: 표 형식 (엑셀과 유사)
                - 열 헤더, 정렬, 열 크기 조정 지원
                
                Grid.Column="1":
                - 오른쪽 열에 배치
                
                Name="lv":
                - 코드 비하인드에서 접근할 이름
                - lv.ItemsSource = person으로 데이터 바인딩
                
                ItemsSource 바인딩:
                - 코드: lv.ItemsSource = person;
                - ListBox와 동일한 데이터 소스
                - 같은 List<Person> 컬렉션 공유
                
                ListView vs ListBox:
                - ListView: GridView로 표 형식
                - ListBox: 사용자 정의 템플릿
                - 둘 다 ItemsControl 상속
            -->
            
            <ListView.View>
                <!-- 
                    ListView.View:
                    - ListView의 표시 방식 정의
                    - GridView: 표 형식 (가장 많이 사용)
                    - IconView, TileView 등도 가능 (사용자 정의)
                -->
                
                <GridView>
                    <!-- 
                        GridView:
                        - 데이터를 표(테이블) 형식으로 표시
                        - 여러 열(GridViewColumn)로 구성
                        - 엑셀 스프레드시트와 유사
                        
                        특징:
                        - 열 헤더 (Header)
                        - 열 크기 조정 (드래그)
                        - 열 정렬 (클릭) - 별도 구현 필요
                        - 각 열마다 다른 바인딩
                        
                        구성:
                        - GridViewColumn으로 각 열 정의
                        - Header: 열 제목
                        - DisplayMemberBinding: 간단한 바인딩
                        - CellTemplate: 복잡한 UI
                    -->
                    
                    <!-- ========== 열 1: 이름 ========== -->
                    <GridViewColumn Header="이름" DisplayMemberBinding="{Binding 이름}"></GridViewColumn>
                    <!-- 
                        GridViewColumn - 이름 열:
                        
                        Header="이름":
                        - 열 헤더(제목) 텍스트
                        - 표 상단에 표시
                        - 사용자가 볼 수 있는 열 이름
                        
                        DisplayMemberBinding="{Binding 이름}":
                        - 간단한 텍스트 바인딩
                        - Person.이름 속성을 TextBlock으로 표시
                        - CellTemplate보다 간단한 방법
                        
                        DisplayMemberBinding 특징:
                        - 텍스트만 표시 가능
                        - 자동으로 TextBlock 생성
                        - 성능 좋음 (간단한 UI)
                        
                        표시 예:
                        ┌──────┐
                        │ 이름 │ ← Header
                        ├──────┤
                        │홍길동│ ← DisplayMemberBinding
                        │임꺽정│
                        │타요  │
                        └──────┘
                    -->
                    
                    <!-- ========== 열 2: 나이 ========== -->
                    <GridViewColumn Header="나이" DisplayMemberBinding="{Binding 나이}"></GridViewColumn>
                    <!-- 
                        GridViewColumn - 나이 열:
                        
                        Header="나이":
                        - 열 헤더 텍스트 "나이"
                        
                        DisplayMemberBinding="{Binding 나이}":
                        - Person.나이 속성 바인딩
                        - int를 자동으로 문자열로 변환
                        
                        자동 형변환:
                        - 나이(int) → "100", "90" (string)
                        - WPF가 자동 처리
                    -->
                    
                    <!-- ========== 열 3: 별점 (ProgressBar) ========== -->
                    <GridViewColumn Header="별점" DisplayMemberBinding="{Binding 별점}" Width="100">
                        <!-- 
                            GridViewColumn - 별점 열:
                            
                            Header="별점":
                            - 열 헤더 텍스트 "별점"
                            
                            DisplayMemberBinding="{Binding 별점}":
                            - 기본 바인딩 (텍스트)
                            - 하지만 CellTemplate으로 재정의됨
                            
                            Width="100":
                            - 열 너비 고정 100픽셀
                            - 사용자가 크기 조정 가능
                            
                            DisplayMemberBinding vs CellTemplate:
                            - DisplayMemberBinding: 간단한 텍스트
                            - CellTemplate: 복잡한 UI (우선순위 높음)
                            - 둘 다 정의하면 CellTemplate 사용
                        -->
                        
                        <GridViewColumn.CellTemplate>
                            <!-- 
                                CellTemplate:
                                - 셀의 복잡한 UI 정의
                                - DisplayMemberBinding 대신 사용
                                - 더 많은 커스터마이징 가능
                                
                                용도:
                                - ProgressBar, Image, Button 등
                                - 여러 컨트롤 조합
                                - 복잡한 레이아웃
                                
                                CellTemplate vs ItemTemplate:
                                - CellTemplate: GridView의 각 셀
                                - ItemTemplate: ListBox의 각 항목
                                - 둘 다 DataTemplate 사용
                            -->
                            <DataTemplate>
                                <!-- 
                                    DataTemplate:
                                    - 각 셀의 UI 정의
                                    - DataContext = Person 인스턴스
                                    - 각 행마다 자동으로 DataContext 설정
                                -->
                                
                                <ProgressBar Value="{Binding 별점}" Width="50" Height="20"/>
                                <!-- 
                                    ProgressBar - 별점 시각화:
                                    
                                    Value="{Binding 별점}":
                                    - Person.별점 속성 바인딩
                                    - 95, 89, 85, 80, 90 등
                                    
                                    Width="50":
                                    - 진행 표시줄 너비 50픽셀
                                    - 열 너비(100)보다 작음
                                    
                                    Height="20":
                                    - 진행 표시줄 높이 20픽셀
                                    - 기본값보다 약간 높음
                                    
                                    시각적 효과:
                                    - 텍스트 "95" 대신 진행 표시줄
                                    - 한눈에 별점 비교 가능
                                    - 더 나은 사용자 경험
                                    
                                    DisplayMemberBinding 없었다면?
                                    - "95", "89" 등 텍스트로 표시
                                    - CellTemplate으로 ProgressBar 표시
                                -->
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                </GridView>
            </ListView.View>
            
            <!--
                ListView 최종 결과:
                
                ┌──────┬─────┬─────────────┐
                │ 이름 │ 나이│   별점      │ ← Header
                ├──────┼─────┼─────────────┤
                │홍길동│ 100 │ [■■■95%] │
                │임꺽정│  90 │ [■■■89%] │
                │타요  │  10 │ [■■■85%] │
                │뽀로로│   5 │ [■■■80%] │
                │타요  │   7 │ [■■■90%] │
                └──────┴─────┴─────────────┘
                
                특징:
                - 열 헤더로 구조 명확
                - 열 크기 조정 가능 (드래그)
                - 선택 가능 (클릭)
                - 표 형식으로 데이터 정렬
            -->
        </ListView>
    </Grid>
    
    <!--
        ListBox vs ListView 비교:
        
        ========== ListBox ==========
        장점:
        - 자유로운 UI 커스터마이징
        - ItemTemplate으로 복잡한 레이아웃
        - 카드형, 타일형 UI
        
        단점:
        - 열 헤더 없음
        - 정렬 기능 없음
        - 표 형식 표현 어려움
        
        사용 예:
        - 사용자 목록 (프로필 이미지 포함)
        - 제품 목록 (이미지 + 설명)
        - 알림 목록 (시간 + 내용)
        
        ========== ListView (GridView) ==========
        장점:
        - 표 형식 (엑셀과 유사)
        - 열 헤더로 구조 명확
        - 열 크기 조정
        - 정렬 구현 용이
        
        단점:
        - 각 열이 독립적
        - 복잡한 레이아웃 어려움
        - 고정된 표 형식
        
        사용 예:
        - 데이터 테이블
        - 파일 탐색기
        - 연락처 목록
        - 데이터베이스 결과
        
        ========== ItemsSource 바인딩 ==========
        
        코드:
        lb.ItemsSource = person;
        lv.ItemsSource = person;
        
        동작:
        1. List<Person> 컬렉션을 ItemsSource에 설정
        2. 각 Person 객체가 항목으로 추가
        3. ItemTemplate 또는 GridView로 표시
        4. 자동으로 DataContext 설정
        
        ObservableCollection:
        - List 대신 ObservableCollection 사용 권장
        - 항목 추가/삭제 시 UI 자동 업데이트
        - INotifyCollectionChanged 구현
        
        예:
        ObservableCollection<Person> people = new ObservableCollection<Person>();
        people.Add(new Person { 이름 = "새 사람", 나이 = 20, 별점 = 90 });
        // UI에 자동으로 추가됨
        
        ========== DataTemplate 활용 ==========
        
        ItemTemplate (ListBox):
        - 각 항목의 전체 UI
        - 자유로운 레이아웃
        - Grid, StackPanel 등 사용
        
        CellTemplate (GridView):
        - 각 셀의 UI
        - 열마다 다른 템플릿
        - ProgressBar, Image, Button 등
        
        공통점:
        - DataTemplate 사용
        - 자동 DataContext (각 항목)
        - {Binding} 구문으로 바인딩
        
        ========== 선택(Selection) 처리 ==========
        
        XAML:
        <ListBox SelectionChanged="ListBox_SelectionChanged"/>
        <ListView SelectionChanged="ListView_SelectionChanged"/>
        
        코드:
        private void ListBox_SelectionChanged(object sender, SelectionChangedEventArgs e)
        {
            if (lb.SelectedItem is Person selectedPerson)
            {
                MessageBox.Show($"선택: {selectedPerson.이름}");
            }
        }
        
        속성:
        - SelectedItem: 선택된 항목 (Person 객체)
        - SelectedIndex: 선택된 인덱스 (0, 1, 2...)
        - SelectedItems: 다중 선택 (SelectionMode.Multiple)
        
        ========== 정렬 (Sorting) ==========
        
        ListView 열 헤더 클릭으로 정렬:
        
        private void GridViewColumnHeader_Click(object sender, RoutedEventArgs e)
        {
            var header = sender as GridViewColumnHeader;
            var sortBy = header.Tag.ToString();
            
            var view = CollectionViewSource.GetDefaultView(lv.ItemsSource);
            view.SortDescriptions.Clear();
            view.SortDescriptions.Add(new SortDescription(sortBy, ListSortDirection.Ascending));
        }
        
        XAML:
        <GridViewColumn Header="이름" DisplayMemberBinding="{Binding 이름}">
            <GridViewColumnHeader Click="GridViewColumnHeader_Click" Tag="이름"/>
        </GridViewColumn>
        
        ========== 필터링 (Filtering) ==========
        
        검색 기능:
        private void SearchTextBox_TextChanged(object sender, TextChangedEventArgs e)
        {
            var view = CollectionViewSource.GetDefaultView(lb.ItemsSource);
            view.Filter = item =>
            {
                if (item is Person person)
                {
                    return person.이름.Contains(searchTextBox.Text);
                }
                return false;
            };
        }
        
        ========== 성능 최적화 ==========
        
        1. VirtualizingStackPanel (기본값):
           - 보이는 항목만 렌더링
           - 대량 데이터 처리
        
        2. EnableRowVirtualization:
           <ListView VirtualizingPanel.IsVirtualizing="True"/>
        
        3. 간단한 바인딩:
           - DisplayMemberBinding > CellTemplate
           - 단순한 UI일수록 성능 좋음
        
        ========== 실전 활용 패턴 ==========
        
        1. 검색 가능한 목록:
           <TextBox x:Name="searchBox" TextChanged="Search"/>
           <ListBox ItemsSource="{Binding FilteredPeople}"/>
        
        2. 페이징:
           <ListView ItemsSource="{Binding CurrentPage}"/>
           <StackPanel>
               <Button Content="이전" Click="PrevPage"/>
               <TextBlock Text="{Binding PageInfo}"/>
               <Button Content="다음" Click="NextPage"/>
           </StackPanel>
        
        3. 마스터-디테일:
           <Grid>
               <ListBox SelectedItem="{Binding SelectedPerson}"/>
               <StackPanel DataContext="{Binding SelectedPerson}">
                   <TextBlock Text="{Binding 이름}"/>
                   <TextBlock Text="{Binding 나이}"/>
               </StackPanel>
           </Grid>
        
        4. 편집 가능한 GridView:
           <GridViewColumn Header="이름">
               <GridViewColumn.CellTemplate>
                   <DataTemplate>
                       <TextBox Text="{Binding 이름, Mode=TwoWay}"/>
                   </DataTemplate>
               </GridViewColumn.CellTemplate>
           </GridViewColumn>
    -->
</Window>
