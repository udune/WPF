<Application x:Class="ch32_스타일.App"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:ch32_스타일"
             StartupUri="MainWindow.xaml">
    <!-- 
        Application 속성:
        
        StartupUri="MainWindow.xaml":
        - 애플리케이션 시작 시 표시될 윈도우
    -->
    
    <Application.Resources>
        <!-- 
            Application.Resources:
            - 애플리케이션 전역 리소스 정의
            - 모든 Window, Page, UserControl에서 접근 가능
            - 스타일, 브러시, 템플릿 등 포함
            
            리소스 범위:
            1. 애플리케이션 수준 (Application.Resources)
               - 가장 넓은 범위
               - 모든 곳에서 접근 가능
            
            2. 윈도우 수준 (Window.Resources)
               - 해당 윈도우 내에서만
            
            3. 컨트롤 수준 (Control.Resources)
               - 해당 컨트롤 내에서만
            
            리소스 조회 순서:
            1. 현재 컨트롤의 Resources
            2. 부모 컨트롤의 Resources
            3. Window.Resources
            4. Application.Resources
            5. 시스템 리소스
        -->
        
        <ResourceDictionary>
            <!-- 
                ResourceDictionary:
                - 리소스를 담는 컨테이너
                - 키-값 쌍으로 관리
                - XAML 리소스의 기본 구조
                
                사용 이유:
                - MergedDictionaries 사용 위해 필요
                - 여러 ResourceDictionary 병합
                - 리소스 구조화 및 모듈화
                
                단순 리소스 정의:
                <Application.Resources>
                    <SolidColorBrush x:Key="MyBrush" Color="Red"/>
                </Application.Resources>
                
                ResourceDictionary 사용:
                <Application.Resources>
                    <ResourceDictionary>
                        <SolidColorBrush x:Key="MyBrush" Color="Red"/>
                    </ResourceDictionary>
                </Application.Resources>
            -->
            
            <ResourceDictionary.MergedDictionaries>
                <!-- 
                    MergedDictionaries:
                    - 여러 ResourceDictionary 파일을 병합
                    - 리소스를 별도 파일로 분리하여 관리
                    - 모듈화 및 재사용성 향상
                    
                    장점:
                    1. 관리 용이:
                       - 스타일별로 파일 분리
                       - ButtonStyles.xaml
                       - TextBoxStyles.xaml
                       - Colors.xaml
                    
                    2. 재사용:
                       - 여러 프로젝트에서 공유
                       - 테마별로 분리 (Light, Dark)
                    
                    3. 성능:
                       - 필요한 리소스만 로드
                       - 지연 로딩 가능
                    
                    4. 협업:
                       - 디자이너와 개발자 분리 작업
                       - 버전 관리 용이
                    
                    병합 순서:
                    - 나중에 병합된 리소스가 우선
                    - 같은 키가 있으면 덮어씀
                    
                    예:
                    <ResourceDictionary.MergedDictionaries>
                        <ResourceDictionary Source="Styles/ButtonStyles.xaml"/>
                        <ResourceDictionary Source="Styles/TextBoxStyles.xaml"/>
                        <ResourceDictionary Source="Themes/LightTheme.xaml"/>
                    </ResourceDictionary.MergedDictionaries>
                -->
                
                <ResourceDictionary Source="Dictionary1.xaml"/>
                <!-- 
                    Dictionary1.xaml 병합:
                    
                    Source="Dictionary1.xaml":
                    - 같은 폴더의 Dictionary1.xaml 파일
                    - 버튼 스타일 정의 포함
                    - 버튼스타일, 버튼스타일2
                    
                    경로 지정 방법:
                    1. 상대 경로 (같은 폴더):
                       Source="Dictionary1.xaml"
                    
                    2. 상대 경로 (하위 폴더):
                       Source="Styles/ButtonStyles.xaml"
                    
                    3. 절대 경로 (프로젝트 루트):
                       Source="/ProjectName;component/Styles/ButtonStyles.xaml"
                    
                    4. 다른 어셈블리:
                       Source="/AssemblyName;component/Styles/ButtonStyles.xaml"
                    
                    Dictionary1.xaml 내용:
                    - 버튼스타일: Salmon 배경, 둥근 모서리
                    - 버튼스타일2: LightGreen 배경, 둥근 모서리
                    
                    사용:
                    MainWindow.xaml:
                    <Button Style="{StaticResource 버튼스타일}">
                    
                    Page1.xaml:
                    <Button Style="{StaticResource 버튼스타일2}">
                    
                    UserControl1.xaml:
                    <Button Style="{StaticResource 버튼스타일}">
                    
                    모든 곳에서 접근 가능:
                    - Application.Resources에 병합
                    - 애플리케이션 전역 범위
                -->
            </ResourceDictionary.MergedDictionaries>
            
            <!-- 
                추가 리소스 정의 가능:
                
                <SolidColorBrush x:Key="PrimaryBrush" Color="#007ACC"/>
                <SolidColorBrush x:Key="SecondaryBrush" Color="#E0E0E0"/>
                
                <Style TargetType="TextBox" x:Key="RoundedTextBox">
                    <Setter Property="BorderThickness" Value="2"/>
                    <Setter Property="BorderBrush" Value="{StaticResource PrimaryBrush}"/>
                </Style>
                
                MergedDictionaries와 함께 사용:
                - MergedDictionaries: 외부 파일
                - 직접 정의: App.xaml 내
            -->
        </ResourceDictionary>
    </Application.Resources>
    
    <!--
        리소스 관리 전략:
        
        ========== 1. 파일 분리 전략 ==========
        
        프로젝트 구조:
        Styles/
        ├── ButtonStyles.xaml       (버튼 스타일)
        ├── TextBoxStyles.xaml      (텍스트박스 스타일)
        ├── Colors.xaml             (색상 리소스)
        └── Icons.xaml              (아이콘 리소스)
        
        Themes/
        ├── LightTheme.xaml         (밝은 테마)
        └── DarkTheme.xaml          (어두운 테마)
        
        App.xaml:
        <ResourceDictionary.MergedDictionaries>
            <ResourceDictionary Source="Styles/Colors.xaml"/>
            <ResourceDictionary Source="Styles/ButtonStyles.xaml"/>
            <ResourceDictionary Source="Styles/TextBoxStyles.xaml"/>
            <ResourceDictionary Source="Themes/LightTheme.xaml"/>
        </ResourceDictionary.MergedDictionaries>
        
        ========== 2. 테마 전환 ==========
        
        코드에서 테마 전환:
        private void SwitchTheme(string themeName)
        {
            var dictionaries = Application.Current.Resources.MergedDictionaries;
            
            // 기존 테마 제거
            var oldTheme = dictionaries.FirstOrDefault(d => 
                d.Source.OriginalString.Contains("Theme"));
            if (oldTheme != null)
                dictionaries.Remove(oldTheme);
            
            // 새 테마 추가
            var newTheme = new ResourceDictionary
            {
                Source = new Uri($"Themes/{themeName}.xaml", UriKind.Relative)
            };
            dictionaries.Add(newTheme);
        }
        
        사용:
        SwitchTheme("DarkTheme");
        
        ========== 3. 조건부 리소스 로드 ==========
        
        App.xaml.cs:
        public App()
        {
            // 사용자 설정에 따라 테마 로드
            var theme = Properties.Settings.Default.Theme;
            LoadTheme(theme);
        }
        
        private void LoadTheme(string themeName)
        {
            var dict = new ResourceDictionary
            {
                Source = new Uri($"Themes/{themeName}.xaml", UriKind.Relative)
            };
            Resources.MergedDictionaries.Add(dict);
        }
        
        ========== 4. 런타임 리소스 추가 ==========
        
        private void AddCustomStyle()
        {
            var style = new Style(typeof(Button));
            style.Setters.Add(new Setter(Button.BackgroundProperty, Brushes.Blue));
            style.Setters.Add(new Setter(Button.ForegroundProperty, Brushes.White));
            
            Application.Current.Resources.Add("CustomButtonStyle", style);
        }
        
        ========== 5. 리소스 딕셔너리 병합 순서 ==========
        
        나중에 병합된 리소스가 우선:
        <ResourceDictionary.MergedDictionaries>
            <ResourceDictionary Source="Base.xaml"/>
            <ResourceDictionary Source="Override.xaml"/>
        </ResourceDictionary.MergedDictionaries>
        
        Base.xaml:
        <SolidColorBrush x:Key="MyBrush" Color="Red"/>
        
        Override.xaml:
        <SolidColorBrush x:Key="MyBrush" Color="Blue"/>
        
        결과:
        MyBrush = Blue (Override.xaml이 우선)
        
        ========== 6. 외부 라이브러리 리소스 ==========
        
        MahApps.Metro 예제:
        <ResourceDictionary.MergedDictionaries>
            <ResourceDictionary Source="pack://application:,,,/MahApps.Metro;component/Styles/Controls.xaml"/>
            <ResourceDictionary Source="pack://application:,,,/MahApps.Metro;component/Styles/Fonts.xaml"/>
            <ResourceDictionary Source="pack://application:,,,/MahApps.Metro;component/Styles/Themes/Light.Blue.xaml"/>
        </ResourceDictionary.MergedDictionaries>
        
        ========== 7. 조건부 컴파일 ==========
        
        App.xaml.cs:
        public App()
        {
#if DEBUG
            LoadResource("Debug.xaml");
#else
            LoadResource("Release.xaml");
#endif
        }
        
        ========== 주의사항 ==========
        
        1. 순환 참조:
           - A.xaml이 B.xaml 참조
           - B.xaml이 A.xaml 참조
           - 런타임 오류 발생
        
        2. 키 충돌:
           - 같은 키가 여러 딕셔너리에 있으면
           - 나중에 병합된 것이 우선
        
        3. 빌드 액션:
           - ResourceDictionary 파일은
           - Build Action: Page로 설정
        
        4. 성능:
           - 너무 많은 리소스는 성능 저하
           - 필요한 것만 로드
        
        5. 메모리:
           - 리소스는 메모리에 유지
           - 사용하지 않는 리소스 제거
    -->
</Application>
