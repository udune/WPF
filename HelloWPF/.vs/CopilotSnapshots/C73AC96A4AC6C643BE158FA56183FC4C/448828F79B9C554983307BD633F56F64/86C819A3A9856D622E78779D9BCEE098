<!-- 
    App.xaml - 데이터바인딩1 학습 애플리케이션의 진입점
    WPF 애플리케이션의 전역 설정 및 리소스를 정의합니다.
-->
<Application x:Class="ch25_데이터바인딩1.App"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:ch25_데이터바인딩1"
             StartupUri="MainWindow.xaml">
    <!-- 
        Application 속성 설명:
        
        x:Class: 코드 비하인드 파일(App.xaml.cs)과 연결
        StartupUri: 애플리케이션 시작 시 표시될 윈도우 지정
        xmlns:local: 현재 프로젝트의 네임스페이스 참조
    -->
    
    <!-- 
        Application.Resources: 애플리케이션 전역 리소스 정의 영역
        
        데이터 바인딩 관련 전역 리소스 예제:
        <Application.Resources>
            ========== Converter (값 변환기) ==========
            
            Bool to Visibility Converter:
            <local:BoolToVisibilityConverter x:Key="BoolToVisConverter"/>
            
            사용:
            <TextBlock Visibility="{Binding IsVisible, Converter={StaticResource BoolToVisConverter}}"/>
            
            구현:
            public class BoolToVisibilityConverter : IValueConverter
            {
                public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
                {
                    return (bool)value ? Visibility.Visible : Visibility.Collapsed;
                }
                
                public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
                {
                    return (Visibility)value == Visibility.Visible;
                }
            }
            
            Int to String Converter:
            <local:IntToStringConverter x:Key="IntToStringConverter"/>
            
            사용:
            <TextBlock Text="{Binding Age, Converter={StaticResource IntToStringConverter}}"/>
            
            Color to Brush Converter:
            <local:ColorToBrushConverter x:Key="ColorToBrushConverter"/>
            
            사용:
            <Rectangle Fill="{Binding SelectedColor, Converter={StaticResource ColorToBrushConverter}}"/>
            
            ========== DataTemplate (데이터 템플릿) ==========
            
            Person Template:
            <DataTemplate x:Key="PersonTemplate">
                <StackPanel>
                    <TextBlock Text="{Binding Name}" FontWeight="Bold"/>
                    <TextBlock Text="{Binding Age}" Foreground="Gray"/>
                </StackPanel>
            </DataTemplate>
            
            사용:
            <ListBox ItemsSource="{Binding People}" 
                    ItemTemplate="{StaticResource PersonTemplate}"/>
            
            Product Template:
            <DataTemplate x:Key="ProductTemplate">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Image Source="{Binding ImagePath}" Width="50" Height="50"/>
                    <StackPanel Grid.Column="1" Margin="10,0,0,0">
                        <TextBlock Text="{Binding Name}" FontSize="16"/>
                        <TextBlock Text="{Binding Price, StringFormat=C}" Foreground="Green"/>
                    </StackPanel>
                </Grid>
            </DataTemplate>
            
            ========== Style (스타일) ==========
            
            TextBox with Validation Error Style:
            <Style x:Key="ValidatedTextBoxStyle" TargetType="TextBox">
                <Setter Property="Padding" Value="5"/>
                <Style.Triggers>
                    <Trigger Property="Validation.HasError" Value="True">
                        <Setter Property="BorderBrush" Value="Red"/>
                        <Setter Property="BorderThickness" Value="2"/>
                        <Setter Property="ToolTip" 
                               Value="{Binding RelativeSource={RelativeSource Self}, 
                                              Path=(Validation.Errors)[0].ErrorContent}"/>
                    </Trigger>
                </Style.Triggers>
            </Style>
            
            사용:
            <TextBox Style="{StaticResource ValidatedTextBoxStyle}"
                    Text="{Binding Age, ValidatesOnExceptions=True}"/>
            
            Required Field TextBox Style:
            <Style x:Key="RequiredFieldStyle" TargetType="TextBox">
                <Setter Property="BorderBrush" Value="Gray"/>
                <Style.Triggers>
                    <Trigger Property="Text" Value="">
                        <Setter Property="BorderBrush" Value="Red"/>
                        <Setter Property="BorderThickness" Value="2"/>
                    </Trigger>
                </Style.Triggers>
            </Style>
            
            ========== ValidationRule (유효성 검사 규칙) ==========
            
            전역 ValidationRule은 리소스로 정의할 수 없지만,
            코드에서 재사용 가능:
            
            public class NotEmptyValidationRule : ValidationRule
            {
                public override ValidationResult Validate(object value, CultureInfo cultureInfo)
                {
                    string str = value as string;
                    if (string.IsNullOrWhiteSpace(str))
                    {
                        return new ValidationResult(false, "값을 입력하세요.");
                    }
                    return ValidationResult.ValidResult;
                }
            }
            
            public class EmailValidationRule : ValidationRule
            {
                public override ValidationResult Validate(object value, CultureInfo cultureInfo)
                {
                    string email = value as string;
                    if (!Regex.IsMatch(email, @"^[^@\s]+@[^@\s]+\.[^@\s]+$"))
                    {
                        return new ValidationResult(false, "올바른 이메일 형식이 아닙니다.");
                    }
                    return ValidationResult.ValidResult;
                }
            }
            
            ========== 실전 활용 예제 ==========
            
            1. 검색 및 필터 UI:
            <Application.Resources>
                <DataTemplate x:Key="SearchResultTemplate">
                    <Border BorderBrush="Gray" BorderThickness="1" Padding="5" Margin="2">
                        <StackPanel>
                            <TextBlock Text="{Binding Title}" FontWeight="Bold"/>
                            <TextBlock Text="{Binding Description}" TextWrapping="Wrap"/>
                            <TextBlock Text="{Binding Date, StringFormat=yyyy-MM-dd}" 
                                      Foreground="Gray" FontSize="10"/>
                        </StackPanel>
                    </Border>
                </DataTemplate>
            </Application.Resources>
            
            사용:
            <TextBox Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"/>
            <ListBox ItemsSource="{Binding SearchResults}" 
                    ItemTemplate="{StaticResource SearchResultTemplate}"/>
            
            2. 폼 입력 UI:
            <Application.Resources>
                <Style x:Key="FormLabelStyle" TargetType="Label">
                    <Setter Property="FontWeight" Value="Bold"/>
                    <Setter Property="Width" Value="100"/>
                </Style>
                
                <Style x:Key="FormTextBoxStyle" TargetType="TextBox">
                    <Setter Property="Margin" Value="5"/>
                    <Setter Property="Padding" Value="5"/>
                </Style>
            </Application.Resources>
            
            사용:
            <StackPanel>
                <StackPanel Orientation="Horizontal">
                    <Label Content="이름:" Style="{StaticResource FormLabelStyle}"/>
                    <TextBox Text="{Binding Name, Mode=TwoWay}" 
                            Style="{StaticResource FormTextBoxStyle}"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal">
                    <Label Content="나이:" Style="{StaticResource FormLabelStyle}"/>
                    <TextBox Text="{Binding Age, Mode=TwoWay}" 
                            Style="{StaticResource FormTextBoxStyle}"/>
                </StackPanel>
            </StackPanel>
            
            3. 마스터-디테일 UI:
            <Application.Resources>
                <DataTemplate x:Key="MasterItemTemplate">
                    <TextBlock Text="{Binding Name}" Padding="5"/>
                </DataTemplate>
                
                <DataTemplate x:Key="DetailTemplate">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <TextBlock Text="{Binding Name}" FontSize="20" FontWeight="Bold"/>
                        <TextBlock Grid.Row="1" Text="{Binding Date, StringFormat=yyyy-MM-dd}"/>
                        <TextBlock Grid.Row="2" Text="{Binding Description}" TextWrapping="Wrap"/>
                    </Grid>
                </DataTemplate>
            </Application.Resources>
            
            사용:
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="200"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <ListBox ItemsSource="{Binding Items}" 
                        SelectedItem="{Binding SelectedItem, Mode=TwoWay}"
                        ItemTemplate="{StaticResource MasterItemTemplate}"/>
                <ContentControl Grid.Column="1" 
                               Content="{Binding SelectedItem}"
                               ContentTemplate="{StaticResource DetailTemplate}"/>
            </Grid>
            
            4. 상태 표시 UI:
            <Application.Resources>
                <local:StatusToColorConverter x:Key="StatusToColorConverter"/>
                
                <DataTemplate x:Key="StatusItemTemplate">
                    <StackPanel Orientation="Horizontal">
                        <Ellipse Width="10" Height="10" 
                                Fill="{Binding Status, Converter={StaticResource StatusToColorConverter}}"/>
                        <TextBlock Text="{Binding Name}" Margin="5,0,0,0"/>
                    </StackPanel>
                </DataTemplate>
            </Application.Resources>
            
            Converter:
            public class StatusToColorConverter : IValueConverter
            {
                public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
                {
                    string status = value as string;
                    return status switch
                    {
                        "Active" => Brushes.Green,
                        "Inactive" => Brushes.Gray,
                        "Error" => Brushes.Red,
                        _ => Brushes.Black
                    };
                }
                
                public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
                {
                    throw new NotImplementedException();
                }
            }
            
            5. 조건부 표시 UI:
            <Application.Resources>
                <BooleanToVisibilityConverter x:Key="BoolToVisConverter"/>
                
                <Style x:Key="ConditionalStyle" TargetType="TextBlock">
                    <Setter Property="Visibility" 
                           Value="{Binding IsVisible, Converter={StaticResource BoolToVisConverter}}"/>
                </Style>
            </Application.Resources>
            
            사용:
            <CheckBox Content="상세 정보 표시" IsChecked="{Binding ShowDetails, Mode=TwoWay}"/>
            <TextBlock Text="상세 정보..." 
                      Visibility="{Binding ShowDetails, Converter={StaticResource BoolToVisConverter}}"/>
            
            ========== StringFormat (문자열 형식) ==========
            
            날짜 형식:
            <TextBlock Text="{Binding BirthDate, StringFormat=yyyy년 MM월 dd일}"/>
            <TextBlock Text="{Binding CreatedDate, StringFormat={}{0:yyyy-MM-dd HH:mm:ss}}"/>
            
            숫자 형식:
            <TextBlock Text="{Binding Price, StringFormat=C}"/>  가격 (통화)
            <TextBlock Text="{Binding Percent, StringFormat=P}"/>  백분율
            <TextBlock Text="{Binding Count, StringFormat=N0}"/>  천 단위 구분
            
            복합 문자열:
            <TextBlock Text="{Binding Name, StringFormat=이름: {0}}"/>
            <TextBlock>
                <TextBlock.Text>
                    <MultiBinding StringFormat="{}{0} ({1})">
                        <Binding Path="Name"/>
                        <Binding Path="Age"/>
                    </MultiBinding>
                </TextBlock.Text>
            </TextBlock>
            
            ========== FallbackValue와 TargetNullValue ==========
            
            FallbackValue (바인딩 실패 시):
            <TextBlock Text="{Binding Name, FallbackValue=이름 없음}"/>
            
            TargetNullValue (값이 null일 때):
            <TextBlock Text="{Binding Description, TargetNullValue=설명 없음}"/>
            
            조합:
            <TextBlock Text="{Binding Email, 
                                    FallbackValue=바인딩 오류, 
                                    TargetNullValue=이메일 없음}"/>
        </Application.Resources>
    -->
    <Application.Resources>
         <!-- 현재 비어 있음 - 필요시 전역 Converter, DataTemplate, Style 추가 -->
    </Application.Resources>
</Application>
