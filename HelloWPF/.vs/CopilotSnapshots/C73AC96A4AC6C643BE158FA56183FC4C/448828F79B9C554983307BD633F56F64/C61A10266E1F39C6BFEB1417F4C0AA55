<!-- 
    ch25 데이터바인딩1 - WPF 데이터 바인딩의 기초를 보여주는 예제 파일
    데이터 바인딩은 UI 요소와 데이터 소스를 연결하여 자동으로 동기화하는 기능입니다.
    코드 비하인드 없이 XAML만으로 UI 요소 간의 데이터 흐름을 정의할 수 있습니다.
    이 예제는 Binding Mode(방향)와 UpdateSourceTrigger(업데이트 시점)를 시연합니다.
-->
<Window x:Class="ch25_데이터바인딩1.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:ch25_데이터바인딩1"
        mc:Ignorable="d"
        Title="MainWindow" Height="450" Width="800">
    
    <StackPanel>
        <!-- 
            StackPanel: 컨트롤들을 수직으로 배치
            데이터 바인딩 예제들을 순서대로 나열
        -->
        
        <!-- ========== 기본 데이터 바인딩 예제 ========== -->
        <TextBox x:Name="tbox"></TextBox>
        <!-- 
            TextBox (소스):
            - 데이터 바인딩의 소스(Source)
            - 사용자가 텍스트를 입력하는 컨트롤
            
            x:Name="tbox":
            - XAML에서 참조할 수 있는 이름
            - ElementName으로 바인딩 소스로 사용
            
            역할:
            - 이 TextBox에 입력한 텍스트가
            - 아래 TextBlock에 실시간으로 표시됨
        -->
        
        <TextBlock Text="{Binding ElementName=tbox, Path=Text}"></TextBlock>
        <!-- 
            TextBlock (타겟):
            - 데이터 바인딩의 타겟(Target)
            - TextBox의 Text를 자동으로 표시
            
            Text="{Binding ElementName=tbox, Path=Text}":
            - Binding 마크업 확장
            - ElementName=tbox: 소스 요소 지정
            - Path=Text: 소스의 Text 속성에 바인딩
            
            데이터 바인딩 기본 개념:
            소스(Source) → 바인딩(Binding) → 타겟(Target)
            tbox.Text → {Binding} → TextBlock.Text
            
            동작:
            1. TextBox에 "안녕"을 입력
            2. tbox.Text = "안녕"
            3. 바인딩이 자동으로 감지
            4. TextBlock.Text = "안녕"으로 자동 업데이트
            5. TextBlock에 "안녕"이 표시됨
            
            데이터 바인딩의 장점:
            - 코드 비하인드 불필요
            - 자동 동기화
            - 선언적 방식
            - 유지보수 용이
            
            기본 바인딩:
            - Mode: 기본값 (대부분 OneWay 또는 TwoWay)
            - UpdateSourceTrigger: 기본값 (PropertyChanged 또는 LostFocus)
        -->
        
        <!-- ========== Binding Mode와 UpdateSourceTrigger 예제 ========== -->
        
        <Label>소스</Label>
        <TextBox Name="tbox1" Text="홍길동"></TextBox>
        <!-- 
            TextBox (소스 - tbox1):
            - 모든 바인딩 예제의 공통 소스
            - 초기값: "홍길동"
            
            Name="tbox1":
            - ElementName으로 참조할 이름
            
            Text="홍길동":
            - 초기 텍스트 값
            
            역할:
            - 이 TextBox의 Text가 소스
            - 아래의 여러 TextBox들이 다양한 방식으로 바인딩
            - Mode와 UpdateSourceTrigger의 차이를 실험
        -->
        
        <Label>타겟</Label>
        
        <!-- ========== OneWay 바인딩 ========== -->
        <Label>OneWay Default</Label>
        <TextBox Text="{Binding ElementName=tbox1, Path=Text, Mode=OneWay, UpdateSourceTrigger=Default}"></TextBox>
        <!-- 
            OneWay 바인딩:
            - 소스 → 타겟 (단방향)
            - 소스 변경 시 타겟 자동 업데이트
            - 타겟 변경 시 소스는 영향 받지 않음
            
            Mode=OneWay:
            - 데이터 흐름: tbox1 → 이 TextBox
            - tbox1.Text 변경 → 이 TextBox 자동 업데이트
            - 이 TextBox 변경 → tbox1 영향 없음
            
            UpdateSourceTrigger=Default:
            - 기본 업데이트 시점
            - TextBox는 일반적으로 LostFocus (포커스 잃을 때)
            
            동작:
            1. tbox1에 "김철수" 입력
            2. 이 TextBox에 "김철수" 자동 표시
            3. 이 TextBox에 "이영희" 입력
            4. tbox1은 여전히 "김철수" (영향 없음)
            
            사용 예:
            - 읽기 전용 표시
            - 계산 결과 표시
            - 상태 정보 표시
        -->
        
        <!-- ========== OneWayToSource 바인딩 ========== -->
        <Label>OneWayToSource PropertyChanged</Label>
        <TextBox Text="{Binding ElementName=tbox1, Path=Text, Mode=OneWayToSource, UpdateSourceTrigger=PropertyChanged}"></TextBox>
        <!-- 
            OneWayToSource 바인딩:
            - 타겟 → 소스 (역방향 단방향)
            - 타겟 변경 시 소스 자동 업데이트
            - 소스 변경 시 타겟은 영향 받지 않음
            
            Mode=OneWayToSource:
            - 데이터 흐름: 이 TextBox → tbox1
            - 이 TextBox 변경 → tbox1 자동 업데이트
            - tbox1 변경 → 이 TextBox 영향 없음
            
            UpdateSourceTrigger=PropertyChanged:
            - 속성 변경 즉시 업데이트
            - 키를 누를 때마다 실시간 업데이트
            
            동작:
            1. 이 TextBox에 "박민수" 입력
            2. 한 글자씩 입력할 때마다
            3. tbox1.Text가 즉시 업데이트
            4. tbox1에 "박민수"가 입력됨
            5. tbox1에 직접 입력해도 이 TextBox는 변경 안 됨
            
            사용 예:
            - 검색어 입력 (입력 즉시 검색)
            - 필터 조건 입력
            - 역방향 컨트롤 (슬라이더 → 값)
            
            주의:
            - OneWay의 반대 방향
            - 드물게 사용됨
        -->

        <!-- ========== TwoWay Default ========== -->
        <Label>TwoWay Default</Label>
        <TextBox Text="{Binding ElementName=tbox1, Path=Text, Mode=TwoWay, UpdateSourceTrigger=Default}"></TextBox>
        <!-- 
            TwoWay 바인딩 (Default):
            - 소스 ↔ 타겟 (양방향)
            - 소스 변경 → 타겟 자동 업데이트
            - 타겟 변경 → 소스 자동 업데이트
            
            Mode=TwoWay:
            - 데이터 흐름: tbox1 ↔ 이 TextBox
            - 양쪽 모두 변경 시 서로 동기화
            
            UpdateSourceTrigger=Default:
            - TextBox의 기본값은 LostFocus
            - 포커스를 잃을 때 (Tab, 클릭 등) 업데이트
            
            동작:
            1. tbox1에 "강유미" 입력
            2. 이 TextBox에 "강유미" 자동 표시
            3. 이 TextBox에 "정우성" 입력
            4. 포커스를 다른 곳으로 이동
            5. tbox1에 "정우성"이 업데이트됨
            
            사용 예:
            - 양방향 데이터 입력
            - 설정 값 편집
            - 폼 입력
            
            Default vs PropertyChanged:
            - Default: 포커스 잃을 때 업데이트 (성능 좋음)
            - PropertyChanged: 키 입력마다 업데이트 (실시간)
        -->
        
        <!-- ========== TwoWay Explicit ========== -->
        <Label>TwoWay Explicit</Label>
        <TextBox Text="{Binding ElementName=tbox1, Path=Text, Mode=TwoWay, UpdateSourceTrigger=Explicit}"></TextBox>
        <!-- 
            TwoWay 바인딩 (Explicit):
            - 양방향이지만 수동 업데이트
            
            UpdateSourceTrigger=Explicit:
            - 자동 업데이트 없음
            - 코드에서 명시적으로 업데이트 호출
            - BindingExpression.UpdateSource() 필요
            
            동작:
            1. 이 TextBox에 "최진실" 입력
            2. 자동으로 tbox1에 반영되지 않음
            3. 코드에서 UpdateSource() 호출 필요
            
            코드 예제:
            var binding = BindingOperations.GetBindingExpression(
                textBox, TextBox.TextProperty);
            binding.UpdateSource(); // 수동 업데이트
            
            사용 예:
            - 저장 버튼 클릭 시 업데이트
            - 유효성 검사 후 업데이트
            - 일괄 처리
            
            장점:
            - 성능 최적화 (불필요한 업데이트 방지)
            - 유효성 검사 가능
            - 사용자 확인 후 업데이트
            
            단점:
            - 코드 비하인드 필요
            - 복잡도 증가
        -->
        
        <!-- ========== TwoWay LostFocus ========== -->
        <Label>TwoWay LastFocus</Label>
        <TextBox Text="{Binding ElementName=tbox1, Path=Text, Mode=TwoWay, UpdateSourceTrigger=LostFocus}"></TextBox>
        <!-- 
            TwoWay 바인딩 (LostFocus):
            - 양방향, 포커스 잃을 때 업데이트
            
            UpdateSourceTrigger=LostFocus:
            - 포커스를 잃을 때 소스 업데이트
            - Tab 키, 마우스 클릭, Enter 등
            
            동작:
            1. 이 TextBox에 "윤아름" 입력
            2. 계속 입력해도 tbox1은 변경 안 됨
            3. Tab 키 또는 다른 곳 클릭
            4. 포커스를 잃는 순간
            5. tbox1에 "윤아름"이 업데이트됨
            
            사용 예:
            - 입력 완료 후 처리
            - 성능 최적화 (입력 중 불필요한 업데이트 방지)
            - 폼 입력 (일반적인 텍스트 박스)
            
            Default와 LostFocus:
            - TextBox의 Default는 LostFocus와 동일
            - 다른 컨트롤은 Default가 다를 수 있음
            
            장점:
            - 성능 좋음 (입력 완료 후 한 번만 업데이트)
            - 입력 중 유효성 검사 없음
            - 사용자가 입력 완료 시점 제어
        -->
        
        <!-- ========== TwoWay PropertyChanged ========== -->
        <Label>TwoWay PropertyChanged</Label>
        <TextBox Text="{Binding ElementName=tbox1, Path=Text, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"></TextBox>
        <!-- 
            TwoWay 바인딩 (PropertyChanged):
            - 양방향, 속성 변경 즉시 업데이트
            
            UpdateSourceTrigger=PropertyChanged:
            - 속성이 변경될 때마다 즉시 업데이트
            - 키를 누를 때마다 실시간 동기화
            
            동작:
            1. 이 TextBox에 "한지민" 입력
            2. 'ㅎ' 입력 → tbox1에 즉시 반영
            3. '한' 입력 → tbox1에 즉시 반영
            4. '한지' 입력 → tbox1에 즉시 반영
            5. 한 글자씩 입력할 때마다 실시간 동기화
            
            사용 예:
            - 실시간 검색
            - 실시간 미리보기
            - 즉각적인 피드백 필요
            - 계산기 (입력 즉시 계산)
            
            장점:
            - 즉각적인 피드백
            - 실시간 동기화
            - 사용자 경험 향상
            
            단점:
            - 성능 영향 (매 입력마다 업데이트)
            - 과도한 이벤트 발생
            - 불완전한 입력 중에도 업데이트
            
            최적화:
            - 디바운싱(Debouncing) 고려
            - 필요한 경우에만 사용
        -->

        <!-- ========== 배경색 바인딩 예제 ========== -->
        <Button x:Name="btn1" Background="Salmon">버튼1</Button>
        <!-- 
            Button (소스 - btn1):
            - 배경색 바인딩의 소스
            
            x:Name="btn1":
            - 바인딩 소스로 사용할 이름
            
            Background="Salmon":
            - 초기 배경색 (연어색)
            
            역할:
            - 이 버튼의 배경색이
            - 아래 버튼에 자동으로 복사됨
        -->
        
        <Button Background="{Binding ElementName=btn1, Path=Background}">버튼2</Button>
        <!-- 
            Button (타겟):
            - 배경색 바인딩의 타겟
            
            Background="{Binding ElementName=btn1, Path=Background}":
            - btn1의 Background를 바인딩
            - ElementName=btn1: 소스 버튼
            - Path=Background: Background 속성
            
            동작:
            1. btn1의 배경색이 Salmon
            2. 이 버튼의 배경색도 Salmon으로 자동 설정
            3. btn1의 배경색을 변경하면
            4. 이 버튼의 배경색도 자동으로 변경됨
            
            Text 속성 외 바인딩:
            - Text: 텍스트 값
            - Background: 배경색
            - Foreground: 전경색
            - FontSize: 글꼴 크기
            - Width: 너비
            - Height: 높이
            - Visibility: 표시 여부
            - IsEnabled: 활성화 상태
            - 등등 모든 속성 바인딩 가능
            
            바인딩 가능한 예:
            <TextBlock FontSize="{Binding ElementName=slider, Path=Value}"/>
            <Button IsEnabled="{Binding ElementName=checkbox, Path=IsChecked}"/>
            <Rectangle Fill="{Binding ElementName=colorPicker, Path=SelectedColor}"/>
        -->
    </StackPanel>
    
    <!--
        데이터 바인딩 전체 요약:
        
        ========== Binding Mode (바인딩 방향) ==========
        
        1. OneWay (기본값, 읽기 전용):
           소스 → 타겟 (단방향)
           - 소스 변경 → 타겟 업데이트
           - 타겟 변경 → 소스 영향 없음
           - 사용: 레이블, 읽기 전용 표시
        
        2. TwoWay (양방향, 편집 가능):
           소스 ↔ 타겟 (양방향)
           - 소스 변경 → 타겟 업데이트
           - 타겟 변경 → 소스 업데이트
           - 사용: 입력 폼, 설정
        
        3. OneWayToSource (역방향):
           소스 ← 타겟 (단방향)
           - 소스 변경 → 타겟 영향 없음
           - 타겟 변경 → 소스 업데이트
           - 사용: 드물게 사용
        
        4. OneTime (한 번만):
           소스 → 타겟 (초기화만)
           - 초기에 한 번만 업데이트
           - 이후 변경 사항 무시
           - 사용: 성능 최적화
        
        ========== UpdateSourceTrigger (업데이트 시점) ==========
        
        1. Default (기본값):
           - 컨트롤마다 다름
           - TextBox: LostFocus
           - CheckBox: PropertyChanged
        
        2. PropertyChanged (즉시):
           - 속성 변경 즉시 업데이트
           - 키 입력마다 업데이트
           - 사용: 실시간 검색, 미리보기
           - 단점: 성능 영향
        
        3. LostFocus (포커스 잃을 때):
           - 포커스를 잃을 때 업데이트
           - Tab, 클릭, Enter 등
           - 사용: 일반적인 폼 입력
           - 장점: 성능 좋음
        
        4. Explicit (수동):
           - 자동 업데이트 없음
           - 코드에서 명시적 호출
           - 사용: 저장 버튼, 유효성 검사
           - 장점: 완전한 제어
        
        ========== Binding 구문 ==========
        
        {Binding ElementName=소스이름, Path=속성경로, Mode=방향, UpdateSourceTrigger=시점}
        
        예제:
        <TextBlock Text="{Binding ElementName=textBox, Path=Text}"/>
        <TextBox Text="{Binding ElementName=source, Path=Text, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
        
        ========== 바인딩 소스 종류 ==========
        
        1. ElementName (XAML 요소):
           {Binding ElementName=tbox, Path=Text}
           - XAML 내 다른 요소
        
        2. RelativeSource (상대 위치):
           {Binding RelativeSource={RelativeSource Self}, Path=Width}
           - Self: 자기 자신
           - FindAncestor: 부모 요소
        
        3. DataContext (데이터 컨텍스트):
           {Binding Path=PropertyName}
           - ViewModel 속성
           - MVVM 패턴
        
        4. Source (직접 지정):
           {Binding Source={StaticResource myData}, Path=Value}
           - 리소스, 객체
        
        ========== 실전 활용 예제 ==========
        
        1. 실시간 검색:
           <TextBox x:Name="searchBox"/>
           <ListBox ItemsSource="{Binding ElementName=searchBox, Path=Text, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"/>
        
        2. 슬라이더와 레이블:
           <Slider x:Name="slider" Maximum="100"/>
           <TextBlock Text="{Binding ElementName=slider, Path=Value}"/>
        
        3. 체크박스로 버튼 활성화:
           <CheckBox x:Name="checkbox" Content="활성화"/>
           <Button IsEnabled="{Binding ElementName=checkbox, Path=IsChecked}"/>
        
        4. 폰트 크기 동기화:
           <ComboBox x:Name="fontSizeCombo"/>
           <TextBox FontSize="{Binding ElementName=fontSizeCombo, Path=SelectedValue}"/>
        
        5. 마스터-디테일:
           <ListBox x:Name="masterList"/>
           <TextBlock Text="{Binding ElementName=masterList, Path=SelectedItem.Name}"/>
        
        ========== 데이터 바인딩의 장점 ==========
        
        1. 코드 감소:
           - 이벤트 핸들러 불필요
           - 자동 동기화
        
        2. 유지보수:
           - 선언적 방식
           - 명확한 데이터 흐름
        
        3. MVVM 패턴:
           - View와 ViewModel 분리
           - 테스트 용이
        
        4. 실시간 동기화:
           - 자동으로 UI 업데이트
           - 일관성 유지
        
        ========== 성능 고려사항 ==========
        
        1. UpdateSourceTrigger:
           - PropertyChanged: 많은 업데이트 (성능 영향)
           - LostFocus: 적은 업데이트 (성능 좋음)
        
        2. Mode:
           - OneTime: 한 번만 (최고 성능)
           - OneWay: 단방향 (좋은 성능)
           - TwoWay: 양방향 (일반 성능)
        
        3. 복잡한 바인딩:
           - 변환기(Converter) 사용 시 성능 고려
           - 다중 바인딩 주의
        
        ========== 주의사항 ==========
        
        1. 순환 참조:
           - A ↔ B 양방향 바인딩 시 무한 루프 가능
           - Mode 설정 주의
        
        2. 초기화 순서:
           - ElementName 바인딩 시 요소가 먼저 생성되어야 함
           - x:Name 반드시 지정
        
        3. 타입 변환:
           - 자동 변환 지원 (문자열 ↔ 숫자)
           - 복잡한 변환은 Converter 필요
        
        4. 디버깅:
           - 바인딩 오류는 Output 창에 표시
           - PresentationTraceSources.TraceLevel 사용
    -->
</Window>
